<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Infinite Rhythm Trainer</title>
    <script>
      window.APP_VERSION = "61";
    </script>
    <link rel="stylesheet" href="style.css?v=61" />
    <link rel="modulepreload" href="fx-webgl.js?v=61" />
    <script src="main.js?v=61" defer></script>
  </head>
  <body>
    <canvas id="fxCanvas" aria-hidden="true"></canvas>
    <main class="app">
      <section id="startScreen" class="screen start-screen">
        <p class="app-version">Build <span id="appVersion"></span></p>
        <button id="startGame" class="start-button" type="button">
          <span class="start-button__liquid" aria-hidden="true"></span>
          <span class="start-button__surface" aria-hidden="true"></span>
          <span class="start-button__gloss" aria-hidden="true"></span>
          <span class="start-button__label">START</span>
        </button>

        <button id="startMusicGame" class="start-music-button" type="button">Niveau musical</button>

        <label class="debug-level">
          Start level (1-10): <span id="startLevelValue">1</span>
          <input id="startLevel" type="range" min="1" max="10" step="1" value="1" />
        </label>

        <section class="controls card">
          <label>
            Input latency offset (ms): <span id="latencyValue">15</span>
            <input id="latency" type="range" min="0" max="200" step="5" value="15" />
          </label>

          <p id="calibrationResult" class="calibration-result">Calibration non lancée.</p>

          <div class="control-buttons">
            <button id="calibration" type="button">Calibration</button>
            <button id="clearCache" type="button">Reset parameters</button>
          </div>
        </section>

        <details class="probabilities card" id="probabilitiesPanel">
          <summary>Settings</summary>

          <label>
            Hit window (ms): <span id="hitWindowDisplay">250</span>
            <input id="hitWindow" type="range" min="250" max="250" step="1" value="250" />
          </label>

          <label>
            Hit tolerance: <span id="hitToleranceDisplay">50 (125 ms)</span>
            <input id="hitTolerance" type="range" min="0" max="100" step="1" value="50" />
          </label>

          <label>
            Perfect window (± ms): <span id="perfectWindowDisplay">30</span>
            <input id="perfectWindowMs" type="range" min="10" max="80" step="1" value="30" />
          </label>

          <label>
            Points recovered per second: <span id="scoreRecoveryPerSecondValue">0.1</span>
            <input id="scoreRecoveryPerSecond" type="range" min="0" max="1" step="0.1" value="0.1" />
          </label>

          <label>
            Max points:
            <input id="maxScore" type="text" inputmode="numeric" value="10" />
          </label>

          <fieldset>
            <legend>FX post-process</legend>
            <label>
              Preset:
              <select id="fxPreset">
                <option value="minimal">minimal</option>
                <option value="soft">soft</option>
                <option value="neon">neon</option>
                <option value="arcade">arcade</option>
                <option value="pulse">pulse</option>
                <option value="insane">insane</option>
              </select>
            </label>
            <label>
              Intensity: <span id="fxIntensityValue">0.8</span>
              <input id="fxIntensity" type="range" min="0" max="1.2" step="0.05" value="0.8" />
            </label>
          </fieldset>

          <fieldset>
            <legend>Visual effects</legend>
            <label>
              <input id="fxToggleBackground" type="checkbox" checked />
              Gradient background
            </label>
            <label>
              <input id="fxToggleWebglEngine" type="checkbox" checked />
              WebGL engine
            </label>
            <label>
              <input id="fxToggleWebglPost" type="checkbox" checked />
              WebGL post-process
            </label>
          </fieldset>

          <fieldset>
            <legend>BPM by level endpoints</legend>
            <div class="dual-slider-row">
              <label>
                BPM @ lvl 1: <span id="bpmLevel1Value">60</span>
                <input id="bpmLevel1" type="range" min="40" max="120" step="1" value="60" />
              </label>
              <label>
                BPM @ lvl 10: <span id="bpmLevel10Value">120</span>
                <input id="bpmLevel10" type="range" min="40" max="120" step="1" value="120" />
              </label>
            </div>
            <p class="computed-setting">Interpolated BPM: <span id="bpmValue">87</span></p>
          </fieldset>

          <fieldset>
            <legend>First hit index weights</legend>
            <div class="dual-slider-row">
              <label>
                Index 2 @ lvl 1: <span id="weightFirst2Level1Value">0</span>
                <input id="weightFirst2Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                Index 2 @ lvl 10: <span id="weightFirst2Level10Value">10</span>
                <input id="weightFirst2Level10" type="range" min="0" max="10" step="1" value="10" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                Index 3 @ lvl 1: <span id="weightFirst3Level1Value">10</span>
                <input id="weightFirst3Level1" type="range" min="0" max="10" step="1" value="10" />
              </label>
              <label>
                Index 3 @ lvl 10: <span id="weightFirst3Level10Value">5</span>
                <input id="weightFirst3Level10" type="range" min="0" max="10" step="1" value="5" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                Index 4 @ lvl 1: <span id="weightFirst4Level1Value">0</span>
                <input id="weightFirst4Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                Index 4 @ lvl 10: <span id="weightFirst4Level10Value">10</span>
                <input id="weightFirst4Level10" type="range" min="0" max="10" step="1" value="10" />
              </label>
            </div>
          </fieldset>

          <fieldset>
            <legend>Jump size weights</legend>
            <div class="dual-slider-row">
              <label>
                Jump 1 @ lvl 1: <span id="weightJump1Level1Value">0</span>
                <input id="weightJump1Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                Jump 1 @ lvl 10: <span id="weightJump1Level10Value">1</span>
                <input id="weightJump1Level10" type="range" min="0" max="10" step="1" value="1" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                Jump 2 @ lvl 1: <span id="weightJump2Level1Value">10</span>
                <input id="weightJump2Level1" type="range" min="0" max="10" step="1" value="10" />
              </label>
              <label>
                Jump 2 @ lvl 10: <span id="weightJump2Level10Value">5</span>
                <input id="weightJump2Level10" type="range" min="0" max="10" step="1" value="5" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                Jump 3 @ lvl 1: <span id="weightJump3Level1Value">0</span>
                <input id="weightJump3Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                Jump 3 @ lvl 10: <span id="weightJump3Level10Value">10</span>
                <input id="weightJump3Level10" type="range" min="0" max="10" step="1" value="10" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                Jump 4 @ lvl 1: <span id="weightJump4Level1Value">10</span>
                <input id="weightJump4Level1" type="range" min="0" max="10" step="1" value="10" />
              </label>
              <label>
                Jump 4 @ lvl 10: <span id="weightJump4Level10Value">2</span>
                <input id="weightJump4Level10" type="range" min="0" max="10" step="1" value="2" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                Jump 5 @ lvl 1: <span id="weightJump5Level1Value">0</span>
                <input id="weightJump5Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                Jump 5 @ lvl 10: <span id="weightJump5Level10Value">4</span>
                <input id="weightJump5Level10" type="range" min="0" max="10" step="1" value="4" />
              </label>
            </div>
          </fieldset>

          <fieldset>
            <legend>Triplet chance by beat</legend>
            <div class="dual-slider-row">
              <label>
                Beat 2 @ lvl 1: <span id="tripletBeat2Level1Value">0.00</span>
                <input id="tripletBeat2Level1" type="range" min="0" max="1" step="0.01" value="0" />
              </label>
              <label>
                Beat 2 @ lvl 10: <span id="tripletBeat2Level10Value">0.30</span>
                <input id="tripletBeat2Level10" type="range" min="0" max="1" step="0.01" value="0.3" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                Beat 3 @ lvl 1: <span id="tripletBeat3Level1Value">0.00</span>
                <input id="tripletBeat3Level1" type="range" min="0" max="1" step="0.01" value="0" />
              </label>
              <label>
                Beat 3 @ lvl 10: <span id="tripletBeat3Level10Value">0.30</span>
                <input id="tripletBeat3Level10" type="range" min="0" max="1" step="0.01" value="0.3" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                Beat 4 @ lvl 1: <span id="tripletBeat4Level1Value">0.00</span>
                <input id="tripletBeat4Level1" type="range" min="0" max="1" step="0.01" value="0" />
              </label>
              <label>
                Beat 4 @ lvl 10: <span id="tripletBeat4Level10Value">0.30</span>
                <input id="tripletBeat4Level10" type="range" min="0" max="1" step="0.01" value="0.3" />
              </label>
            </div>
          </fieldset>

          <fieldset>
            <legend>After beat-2 triplet: note position in beat 3</legend>
            <div class="dual-slider-row">
              <label>
                16th #1 @ lvl 1: <span id="afterTriplet2Pos1Level1Value">10</span>
                <input id="afterTriplet2Pos1Level1" type="range" min="0" max="10" step="1" value="10" />
              </label>
              <label>
                16th #1 @ lvl 10: <span id="afterTriplet2Pos1Level10Value">10</span>
                <input id="afterTriplet2Pos1Level10" type="range" min="0" max="10" step="1" value="10" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                16th #2 @ lvl 1: <span id="afterTriplet2Pos2Level1Value">0</span>
                <input id="afterTriplet2Pos2Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                16th #2 @ lvl 10: <span id="afterTriplet2Pos2Level10Value">0</span>
                <input id="afterTriplet2Pos2Level10" type="range" min="0" max="10" step="1" value="0" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                16th #3 @ lvl 1: <span id="afterTriplet2Pos3Level1Value">0</span>
                <input id="afterTriplet2Pos3Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                16th #3 @ lvl 10: <span id="afterTriplet2Pos3Level10Value">0</span>
                <input id="afterTriplet2Pos3Level10" type="range" min="0" max="10" step="1" value="0" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                16th #4 @ lvl 1: <span id="afterTriplet2Pos4Level1Value">0</span>
                <input id="afterTriplet2Pos4Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                16th #4 @ lvl 10: <span id="afterTriplet2Pos4Level10Value">0</span>
                <input id="afterTriplet2Pos4Level10" type="range" min="0" max="10" step="1" value="0" />
              </label>
            </div>
          </fieldset>

          <fieldset>
            <legend>After beat-3 triplet: note position in beat 4</legend>
            <div class="dual-slider-row">
              <label>
                16th #1 @ lvl 1: <span id="afterTriplet3Pos1Level1Value">10</span>
                <input id="afterTriplet3Pos1Level1" type="range" min="0" max="10" step="1" value="10" />
              </label>
              <label>
                16th #1 @ lvl 10: <span id="afterTriplet3Pos1Level10Value">10</span>
                <input id="afterTriplet3Pos1Level10" type="range" min="0" max="10" step="1" value="10" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                16th #2 @ lvl 1: <span id="afterTriplet3Pos2Level1Value">0</span>
                <input id="afterTriplet3Pos2Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                16th #2 @ lvl 10: <span id="afterTriplet3Pos2Level10Value">0</span>
                <input id="afterTriplet3Pos2Level10" type="range" min="0" max="10" step="1" value="0" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                16th #3 @ lvl 1: <span id="afterTriplet3Pos3Level1Value">0</span>
                <input id="afterTriplet3Pos3Level1" type="range" min="0" max="10" step="1" value="0" />
              </label>
              <label>
                16th #3 @ lvl 10: <span id="afterTriplet3Pos3Level10Value">0</span>
                <input id="afterTriplet3Pos3Level10" type="range" min="0" max="10" step="1" value="0" />
              </label>
            </div>
            <div class="dual-slider-row">
              <label>
                16th #4 @ lvl 1 (forbidden): <span id="afterTriplet3Pos4Level1Value">0</span>
                <input id="afterTriplet3Pos4Level1" type="range" min="0" max="10" step="1" value="0" disabled />
              </label>
              <label>
                16th #4 @ lvl 10 (forbidden): <span id="afterTriplet3Pos4Level10Value">0</span>
                <input id="afterTriplet3Pos4Level10" type="range" min="0" max="10" step="1" value="0" disabled />
              </label>
            </div>
          </fieldset>
        </details>

        <details class="card test-log-panel">
          <summary>Pattern / timing log</summary>
          <pre id="testLog" class="test-log">Les patterns, erreurs et timings seront affichés ici.</pre>
        </details>
      </section>

      <section id="gameScreen" class="screen game-screen hidden">
        <button id="stopGame" class="stop-button" type="button">STOP</button>
        <p id="tapJudgement" class="tap-judgement" aria-live="polite"></p>
        <p class="game-level">Level <span id="gameLevelValue">1</span></p>
        <button id="tapZone" class="tap-zone" aria-label="Tap input zone">
          <span class="tap-zone__liquid" aria-hidden="true"></span>
          <span class="tap-zone__score-liquid" aria-hidden="true"></span>
          <span class="tap-zone__surface" aria-hidden="true"></span>
          <span class="tap-zone__caustics" aria-hidden="true"></span>
          <span class="tap-zone__gloss" aria-hidden="true"></span>
          <span id="tapZoneText" class="tap-zone__text">READY?</span>
        </button>
      </section>

      <section id="resultScreen" class="screen result-screen hidden">
        <h1 id="resultTitle"></h1>
        <p id="resultText"></p>
        <button id="backToMenu" type="button">Back to menu</button>
      </section>
    </main>
  </body>
</html>
